<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Short to-do notes</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
        <link rel="stylesheet" href="css/custom-styles.css">
        <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
        <script>
            $(document).bind("mobileinit", function(){
                 $.support.cors = true;
                 $.mobile.allowCrossDomainPages = true;
                 $.mobile.touchOverflowEnabled = true;
            });
        </script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
        <!--<script type="text/javascript" src="cordova.js"></script>-->
        

    </head>
    <body>
        <div data-role="page" id="index">
            <div data-role="header" data-theme="a">
                <h1>Short Notes</h1>
            </div>
            <div data-role="content">
                <ul id="toDoItemList" data-role="listview" data-divider-theme="a" data-inset="true" data-autodividers="true" data-split-icon="forward">

                </ul>
            </div>
            <form action="#" method="post" id="listForm">
                    <div data-role="fieldcontain">
                        <label for="newItem">Enter to-do Item</label>
                        <input type="text" placeholder="Enter your to-do item" id="newItem"/>
                        <input id="addItem" type="submit" value="Add"/>
                    </div>
            </form>
        </div>
        <script>
            $(function(){
                var theList = $("#toDoItemList");
                var item = $("#newItem");
                var addButton = $("#addItem");
                
                $("#listForm").on('submit', function(event){
                    //$("#addItem").on('tap', function(event){
                        $("#toDoItemList").append('<li class="list">'+ item.val() +'</li>');
                        item.val(" ");
                        populateStorage();
                        setValues();
                        event.preventDefault();
                        return false;
                   
                   // });
                    //event.preventDefault();
                    //return false;
                });
                
                $("#toDoItemList").on('swipe',function(event){ 
                    var t = event.target;
                    if(t.nodeName === 'LI' || t.nodeName === 'TEXTAREA' || t.nodeName === 'UL'){
                        if($(this).hasClass('list')){ 
                            t.parentNode.removeChild( t );
                        }
                        else {
                            $(this).addClass('list');
                        }
                        populateStorage();   
                    };
                    event.preventDefault();
                    return false;
                });
                
                //let the user edit to-do item
                $("#toDoItemList").on('tap', 'li', function(event){ 
                    var tag = event.target;
                    if(tag.nodeName === 'LI'){
                        //$( "#toDoItemList" ).add( "textarea" ).css( "id", "editArea" );
                        
                       // var newElement = $("#editArea");
                        //console.log(newElement.html());
                        console.log(tag);
                        //tag.parentNode.replaceChild(newElement.html(), tag);
                        
                        $(tag).replaceWith("<textarea id='editArea'></textarea>");
                        console.log($(tag));
                        $("#editArea").val($(tag).text()); 
                        populateStorage();
                        event.preventDefault();
                    }
                    event.preventDefault();
                    return false;
                 });
                 
                //change back to list item after editing
                $("#toDoItemList").on('tap',function(event){
                    var targetnode = event.target;
                    if(targetnode.nodeName === 'UL' || targetnode.nodeName ==='DIV' || targetnode.nodeName === 'DOCUMENT'){
                        var oldElement = $("#editArea");
                        //$("#toDoItemList").add('li').css("class", "list");
                        
                        //var newElement = $(".list");
                        $(oldElement).replaceWith("<li class='list'></li>");
                        $(".list").val($(oldElement).text());
                       //targetNode.replaceWith()
                        populateStorage();
                        event.preventDefault();
                    }
                    event.preventDefault();
                    return false;
                });
            
            $(document).ready(function(){
                if(localStorage.ItemList){
                        theList.text(localStorage.getItem('ItemList'));
                    }    
            });
            //window.addEventListener('DOMContentLoaded', setValues);
                
                function populateStorage(){
                    localStorage.setItem('ItemList', theList.text() );
                }
                function setValues(){
                    if(localStorage.ItemList){
                        theList.text(localStorage.getItem('ItemList'));
                    }
                }
                
                
            });
        </script>
    </body>
</html>
